#第22章高级udp 套接字

对于udp编程而言，每一个操作对应一个udp数据包，因此当收取的数据报大于应用进程的缓冲区的时候就产生了如何处理的问题

在udp程序小中我们必须要设置一些udp的特性，来处理udp的不可靠性，如超时重传、序列号，我们将开发一组udp应用程序中已处理这些不足

####22.2接收标志、目的ip和接口索引	

历史上sendmsg和recvmsg一直用于通过unix域套接字传递的描述符，而且甚至用途也不多见

1）msghdr结构中的msg_flags成员返回标志给应用进程。

2)辅助数据正被用于应用进场和内核之间传递越来越多的数据


####22.3数据报截断

当一个UDP数据报超过应用进程提供的缓冲区的时候，recvmsg在其msghdr结构体内msg_flags设置MSG_TRUNC，但是并不是所有程序都这么处理，这里存在三种可能丢失的情况。

1.丢弃超出部分的字节并向应用程序进程返回MSG_TRUNC标志。本处理方式要求应用进程调用recvmsg来接收这个标志。

2.丢弃超出部分的字节，但是不告诉应用进程这个事实。

3.保留超出部分的字节并在同一套接字上后续的读操作中返回它们。

既然不同的实现在处理超过应用程序缓冲的部分的处理上有差异，检测本问题有一个有效的方法、；总是分配比应用程序多一个字节的应用程序缓冲区，如果长度等于 该缓冲区的数据报，那么就认定他是一个过长数据。

####22.4何时用udp 代替tcp

udp比tcp的优势在哪里？

1.udp 支持广播和多播，tcp不支持

2.udp没有链接的建立和拆除，udp只需要两个分组就可以交换一个请求和应答（假设两者长度都小于系统的mtu），tcp需要20个分组

3.对于海量的数据请求不应该使用udp，udo只能是在应对合理大小的请求和应答的时候使用。

####22.5 udp 应该增加可靠性

需要给udp增加可靠性，必须要做到

1.超时和重传

2.加入序列号

序列号是请求应答式的大多数udp应用进程的一部分，例如dns服务解析器，RPC等待。

序列号比较简单，每一个请求必须带一个序列号，服务器必须先在返送客户的应答中回射这个序列号。

处理超时和应答还是老办法，发送一个请求等待n秒，如果没有，则在发送一个请求等待n秒，发送一定次数以后则放弃发送。


####22.6 绑定接口和地址	